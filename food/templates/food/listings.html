{% extends "base.html" %}
{% block content %}
<style>
  body {
    background-color: #E5E6C4;
  }

  .top-box {
    border: 2px solid black;
    border-radius: 15px; /* Rounded corners */
    padding: 20px;
    margin: 0 auto 30px;
    max-width: 100%;
    background-color: white; /* Optional */
  }

  /* Left-align heading */
  .top-box h3 {
    margin-bottom: 20px;
    font-weight: bold;
    text-align: left;
  }

  .form-label {
    font-weight: 500;
    margin-bottom: 5px;
  }

  .search-btn {
    background-color: #222725;
    color: #FFFFFF;
    border: none;
    height: calc(1.5em + 0.75rem + 2px); /* match Bootstrap input height */
  }

  .search-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap; /* stack on smaller screens */
    align-items: flex-end; /* button aligned with bottom of inputs */
  }

  .search-field {
    flex: 1; /* grow to fill available space */
  }

  @media (max-width: 767px) {
    .search-btn {
      width: 100%;
      margin-top: 10px;
    }
  }
</style>

<div class="container py-5">
  <!-- Top black-outlined box -->
  <div class="top-box">
    <!-- Line 1: Left-aligned Heading -->
    <h3>Find Food Near You</h3>

    <!-- Line 2: Search bar row -->
    <div class="search-row">
      <!-- Food input (first) -->
      <div class="search-field">
        <label class="form-label" for="food-search">What are you looking for?</label>
        <input type="text" id="food-search" class="form-control" placeholder="Enter food name">
      </div>

      <!-- Location input (second) -->
      <div class="search-field">
        <label class="form-label" for="location-search">Location</label>
        <input type="text" id="location-search" class="form-control" placeholder="Enter location">
      </div>

      <!-- Search button (right, aligned with inputs) -->
      <div class="d-flex align-items-end">
        <button class="search-btn">Search</button>
      </div>
    </div>
  </div>

  <!-- Page heading -->
  <h2 class="mb-4 eggshell-text">Find Food</h2>

  <div class="row" id="listings-container">
    {% for listing in listings %}
      <div class="col-md-4 mb-4 listing-card" data-title="{{ listing.title|lower }}" data-location="{{ listing.location|lower }}">
        <div class="card job-card">
          {% if listing.image %}
            <img src="{{ listing.image.url }}" class="card-img-top img-card-300 img-fluid" alt="{{ listing.title }}">
          {% endif %}
          <div class="card-body">
            <h5 class="card-title">{{ listing.title }}</h5>
            <p class="card-text">{{ listing.description|truncatewords:20 }}</p>
            <p class="card-text"><small>Location: {{ listing.location }}</small></p>
            <a href="{% url 'listing_detail' listing.pk %}" class="btn navy-bg eggshell-text btn-sm">View Details</a>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12"><p class="eggshell-text">No listings yet.</p></div>
    {% endfor %}
  </div>
</div>

<!-- JavaScript for live filtering -->
<script>
  const foodInput = document.getElementById('food-search');
  const locationInput = document.getElementById('location-search');
  const listings = document.querySelectorAll('.listing-card');
  const searchBtn = document.querySelector('.search-btn');

  function filterListings() {
    const foodQuery = foodInput.value.toLowerCase();
    const locationQuery = locationInput.value.toLowerCase();

    listings.forEach(listing => {
      const title = listing.getAttribute('data-title');
      const location = listing.getAttribute('data-location');

      if (title.includes(foodQuery) && location.includes(locationQuery)) {
        listing.style.display = '';
      } else {
        listing.style.display = 'none';
      }
    });
  }

  foodInput.addEventListener('input', filterListings);
  locationInput.addEventListener('input', filterListings);
  searchBtn.addEventListener('click', filterListings);
</script>
{% endblock %}








